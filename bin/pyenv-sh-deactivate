#!/usr/bin/env bash
#
# Summary: Deactivate virtual environment
#
# Usage: pyenv deactivate
#
# Deactivate a Python virtual environment.

set -e
[ -n "$PYENV_DEBUG" ] && set -x

unset QUIET
if [ "$1" = "--quiet" ]; then
  QUIET=1
  shift 1
fi

shell="$(basename "${PYENV_SHELL:-$SHELL}")"
case "$shell" in
fish )
  echo "if functions -q deactivate"
  ;;
*    )
  echo "if declare -f deactivate 1>/dev/null 2>&1; then"
  ;;
esac

if [ -z "${PYENV_VIRTUALENV_INIT}" ]; then
  # Backward compatibility issue
  # https://github.com/yyuu/pyenv-virtualenv/issues/26
  echo "  pyenv shell --unset;"
fi

case "$shell" in
fish )
  echo "  setenv PYENV_DEACTIVATE \"\$VIRTUAL_ENV\";"
  ;;
*    )
  echo "  export PYENV_DEACTIVATE=\"\$VIRTUAL_ENV\";"
  ;;
esac

cat <<EOS
  deactivate;
else
EOS

if [ -z "$QUIET" ]; then
  echo "  echo \"pyenv-virtualenv: no virtualenv has been activated.\" 1>&2;"
fi

echo "  false;"

case "$shell" in
fish )
  echo "end;"
  ;;
*    )
  echo "fi;"
  ;;
esac
